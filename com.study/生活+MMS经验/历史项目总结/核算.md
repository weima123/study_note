### 一.业务背景
```
      目前公司主要业务是做员工费用报销的；客户在我们系统内产生的各类业务数据，需要在某些节点（比如：审批通过、审核通过）生成财务凭证推送给客户。不同的客户财务凭证的样式、凭证的生成规则都不一样；
  之前每当有需要用到财务核算功能的新客户上线时，我们都需要针对客户的核算业务单独开发一套核算服务，去处理财务凭证生成、推送的业务；这极大的延长了新项目交付的周期，另外也增加了公司的项目交付
  成本；因此2018年12公司决定开发一套核算规则引擎，用来处理不同客户的核算诉求。
  
  
````

### 二.业务架构
##### 1.业务架构
```
helios业务系统数据---->核算平台---->下游系统
```
```
上游业务端会在某些节点推送业务数据给核算平台，核算平台在生成财务凭证后，再将凭证数据通过接口查询以及文件导出的方式推送给客户
```
##### 2.核算平台主要的模块
###### 核算字段的含义----在凭证生成过程中需要用的业务数据对象的属性
###### 1）核算字段预置模块
```
 1）核算平台根据上游系统的数据结构预置了一套核算字段
 2）业务数据传输到核算平台生成凭证的时候，通过java反射将业务数据赋值到核算字段上
 3）后续客户通过操作核算字段来进行凭证内容的提取
```
###### 2）客户凭证样式定义模块
```
1）定义客户每个凭证字段的名称、类型
2）定义客户每个凭证字段的数据库存储位置
```
##### 3）借贷模块：借贷方向定义、借贷金额定义
```
1)客户借贷金额、借贷方向的配置
2）定义借贷相等相关的校验规则
```
##### 4）科目模块：科目定义、科目匹配规则定义
```
1)客户科目的基础数据保存
2）核算过程中科目匹配规则的定义，来源值-核算字段，目标值-客户自己配置
```
##### 5）凭证内容提取模块
```
客户可以对提供的核算字段进行凭证内容的提取
1）四则运算
2）逻辑运算
3）函数运算：LEFT 、Right、
```
###### 6）凭证数据导出模块
```
1）文件：excel csv txt
2)接口对接：
```

### 三.代码架构
```
1.项目框架：springBoot + redis + springCloud-sleuth+springCloud-hytrix + mysql
2.项目开发速度保障：增量初始化、工厂模式（分录生成、分录导出）
3.项目高可用保障:缓存 、服务熔断、线程池
4.项目可扩展性保障：工厂模式支持支持后续快速接入新的凭证生成规则额
```


### 四、遇到的问题
#### 1.技术类问题
##### 设计阶段
```
1.不同凭证的生成过程：工厂模式抽离公共代码，实现业务解耦

2.凭证数据存储，需要支持不同客户的不同的字段个数的要求，并且需要兼顾我们公司后续凭证报表的需求
1)数据库动态字段列:支持不同客户对凭证字段个数的需求
2)固化字段：对于核算平台关心的的数据字段，强制客户配置为固化字段，固化字段后续自动从自定义字段列获取字段内容，
方便后续出报表、方便后续开放凭证相关的公共查询业务

3.凭证生成接口幂等性校验防止重复生成
1）数据库凭证头、行都保存了来源业务数据的id，后期在凭证生成时优先根据该表做重复性校验
2）分布式锁

4.对于客户在凭证预览、以及后续凭证接口字段名称不一样的需求？
继承JacksonAnnotationIntrospector 实现基于现有业务的序列化
```
##### 代码优化阶段
```
1.凭证生成耗时？线程池、缓存
2.部分配置界面数据查询慢的问题？sql优化
3.动态查询问题：数据库操作时间+60s
```

#### 2.非技术类问题
```
1.垮团队资源协调
2.项目测试进度及时沟通、项目中遇到的问题及时向上反馈
3.根据用户反馈，提出一些产品的优化点 ---1.凭证预览（测试） 2.异常信息明确化方便测试（测试） 3.垮环境配置迁移
```

### 五.项目带来的收益
##### 1.公司
```
  减少了新项目交付的周期(使用了核算的平台项目交付周期基本由一个月缩减到了半个月），节约了公司成本
```

##### 2.个人
```
1.加强了自己垮团队协作的能力
2.获得了项目进度追踪相关的经验和能力

```

### 六.基础概念
##### 1.什么是核算？
```
财务对公司已发生的资金流动进行事后盘算的过程称为核算，主要统计公司的资产、负债、所有者权益和各项损益的变动
```

##### 2.什么是科目？
```
 为了更好的进行核算，需要提前根据不同业务的特点以及国家政策要求，提前确定好核算的项目。这种对会计要素进行分类核算的项目，称为科目。
```

##### 3.什么是借贷？
```
借贷本身没有什么意义，只是财务记账的一种符号，表示会计要素增加或减少的记账方向。置于"借"表示增加还是"贷"表示增加，则取决于账户的性质与结构。

```

##### 4.什么是会计要素？
```
会计要素分为资产、负债、所有者权益（股东权益）、收入、费用（成本）和利润六个会计要素。
```



